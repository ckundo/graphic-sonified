let result, el, ctx, path, noise, playing, audioCtx;

function handleMove(event) {
  event.preventDefault();
  const touches = event.changedTouches;
  [...touches].forEach(touch => {
    result.innerText = [touch.pageX, touch.pageY];

    if (ctx.isPointInPath(path, touch.pageX, touch.pageY) ||
      ctx.isPointInPath(star, touch.pageX, touch.pageY)
    ) {
      if (noise && playing) { audioCtx.suspend(); playing = false; el.style.opacity = 1; }
    } else {
      if (noise && !playing) { audioCtx.resume(); playing = true; el.style.opacity = 0.8; }
    }
  });
}

function load() {
  el = document.querySelector("#canvas");
  audio = document.querySelector("audio");
  path = new Path2D("M25.42,329.91A63.4,63.4,0,0,0,25,345.36c2.26,34.85,3.47,69.75,5,104.64.28,6.49,2.31,12.55,4.66,18.72,3.45,9,8.13,17.73,9.53,27.54.31,2.13-.33,4-.69,5.84-1.66,8.68-1.17,17.56-2.69,26.24-.41,2.29-1,4.48-3.38,6.29-1.25-4.72-2.35-9.19-2.1-13.76A16.92,16.92,0,0,0,32,509.62c-3.27-4.49-4.94-10-10.18-13.28-2.56-1.59-3.12-5.32-3.27-8.59a81.71,81.71,0,0,1,2.07-23.27,39.21,39.21,0,0,0-.18-18.77,33.94,33.94,0,0,1-.73-6.92,460.14,460.14,0,0,0-9.56-82.61c-3.52-16.45-4.8-33.26-5.32-50-.53-16.94.79-33.93.45-50.85-.38-19.14,4-37,9.9-54.88a201.22,201.22,0,0,1,17.11-38.14C41,147.47,49.89,132.81,61.79,120c7.68-8.26,14.36-17.69,23.69-24,12-8.1,22.39-18.24,35.47-24.86,10-5.09,18.56-12.8,28.45-18.42,11.67-6.64,23.81-12.27,36.61-15.6,17-4.44,33.77-10.44,51.39-12.31,14.15-1.51,28.13-3.2,42.67-1.55C292,24.61,304,27,316.23,26.34c9.25-.5,17.71,4.22,26.86,5.12,13.89,1.36,27.65,3.88,41.6,4.78,4.46.29,8.87,1.6,13.34,1.76a130.66,130.66,0,0,0,33.62-3.28c32.12-7.3,63.47-17.44,95-26.87C539,4.16,551.58.77,564.71.11c16.94-.85,32.86,3.46,49,7.6,7.66,2,15,5.47,23.07,5.81a12,12,0,0,1,5.7,1.71C659.06,25.87,678,23.52,696.21,25c13.43,1.05,26.85,2.15,40.24,3.55a55.81,55.81,0,0,0,10.91-.41c10.23-.87,20.14,2.19,30.29,2.36a10.49,10.49,0,0,1,5.15,1.76c11.2,7.11,24.29,8.87,36.54,12.94,10,3.33,20.11,7.34,28.18,13.53,6.64,5.09,12.2,12.95,13.44,22.47,2.45,18.69,6.88,37,15.71,53.66,5.78,10.91,11.34,21.79,15.27,33.48A33.47,33.47,0,0,1,893.7,175,75.09,75.09,0,0,0,902.31,202c4.45,8.4,8.42,17,10.06,26.46,2,11.25,6.8,21.55,10.07,32.34,4.75,15.7,9.94,31.3,12.82,47.55,1.13,6.4,1.93,12.8,2.63,19.23.76,7,6,11,14.3,12.2,9.37,1.4,18.78,2.12,28.18,3.08a12.86,12.86,0,0,1,5.63,1.89c2.6,1.66,4,3.62,3,7.06-.91,3.24-2.62,4.9-5.9,5-10.95.17-21.94-.4-32.84-.27-22.43.27-37.51-13.45-53.73-25.44-6.62-4.89-11.91-11.14-17-17.45-3-3.7-4.67-1-7,.27-2.92,1.58-2.58,3.55-.85,5.69,10.13,12.55,21,24.11,36.27,30.76,13.21,5.75,26.1,12.24,39.93,16.49a40,40,0,0,0,9.75,2c5.54.28,10.47,5.41,10.49,10.76,0,2.61-1.9,2.86-3.83,2.71-8.29-.65-16.66-.93-24.7-3.2-4.11-1.15-4.84.16-4.84,3.95,0,11-3,21.6-4.9,32.35a26,26,0,0,0-.82,3.38,358,358,0,0,1-8.29,61.85c-5,23-10.4,46.32-24.56,65.85-10.86,15-21.11,30.92-39.13,39-14.74,6.58-30.26,8.26-45.26,3.32-12.37-4.07-23.65-14.87-23.13-28.81.35-9.18,5.61-18,13.07-20.82,8.31-3.18,17-1.51,22.63,4.36,5,5.18,4.33,7.39-2.21,10.13-3,1.25-5.64,3.43-8.43,5.21-.58.38-1.08,1-.63,1.64a2.26,2.26,0,0,0,1.63.84c12.52-.31,24.45-2.74,32.52-13.29,9.28-12.13,15.49-26.09,19.56-40.66,3.45-12.36,3.91-25.37,4.82-38.18.81-11.42.06-23,.73-34.3,1.22-20.38-2.29-40.35-2.81-60.53a9,9,0,0,0-.75-3.89c-5.92-11.21-4.27-24.29-9.1-35.94-2.38-5.75-3-11.94-8.17-16.46-3.23-2.79-6.72-5-10.63-4.76-8,.48-14.59-2.84-20.87-6.92-3.68-2.39-5.22-1.18-6.6,2.27a63.29,63.29,0,0,1-4.23,9c-2.14,3.55-5.4,4.89-9.43,3.16C787,315.21,774.57,309.15,766,297.49c-1.68-2.28-3.88-4-6.84-2.78-6.41,2.61-12.28.42-17.7-2.39a45.51,45.51,0,0,1-13.36-10.25c-3.08-3.52-14.39-5.91-18.54-3.86-2.64,1.29-2,4-2.79,6.05-1,2.47-.25,6.55-3.91,6.66-3.12.09-3.31-3.69-4.41-6a50.19,50.19,0,0,1-1.92-5.14c-2.9-8.46-8-11.75-16.7-11-3.34.29-4.67,2.43-5,5.27-.52,4.79-1.89,9.09-5.62,12.4a3.52,3.52,0,0,0-1,1.72c-3.79,15.35-10.77,29.8-9.59,46.51.65,9.13,1.64,18.35,1.79,27.44.34,19.43,2.78,38.93-3.33,58.37a134.06,134.06,0,0,0-5.62,33.22c-.25,5.06-2.12,10.05-3.26,15.07a86.24,86.24,0,0,0-2.06,19.81c.07,12.95-3.63,25.23-6.84,37.59-.17.64-.62,1.28-.57,1.9,1,13.19-3.5,25.28-7,37.66A68.21,68.21,0,0,0,629.65,589c.6,8.34,5.36,14.83,12,20a98.23,98.23,0,0,1,14,12.72c6.27,7.12,7,15.54,7.18,24.21.06,3.78-2.11,6-6.2,6.39a386.8,386.8,0,0,1-43.33,2.07c-5.72-.1-11.45,1.65-17.2,2.34a81,81,0,0,1-21.39,0c-15.71-2.3-31.38-3-47.09.33-8,1.67-20.27-6.86-22-14.8-.7-3.25-.27-6.69,1.85-9,8.94-9.93,8.84-22.35,9.52-34.36.77-13.77-.72-27.71,1.18-41.36,3.28-23.64-1.46-46.78-3.27-70.08-.67-8.65-3.69-17.2-6.25-25.61-3.54-11.64-8-23-11.43-34.69-2.43-8.23-8.66-13.13-14.33-18.62-1.69-1.63-4.12-.77-6.25-.44C465.16,409.86,454.5,414,444,418.81c-6.37,2.94-12.17,6.84-18.34,10a258.62,258.62,0,0,1-68,24,80.46,80.46,0,0,1-21.34,1.2A25.06,25.06,0,0,0,321,457.41c-5.66,3.48-11.38,6.89-17.66,9.24a27.63,27.63,0,0,0-6.08,3.42c-7,4.93-7.34,6.5-3.9,14.41s4.56,16.73,5,25.31c.86,16,2.95,31.73,8.33,46.9a2.32,2.32,0,0,1,.25,1c-1.52,10.31,4.7,17.13,11.19,23.46a125.68,125.68,0,0,0,17.53,14.48c3.32,2.23,6.14,4.34,7.79,8,1.86,4.09,3.93,8.08,5.67,12.22,1.42,3.4.34,6.08-2.18,9-12.79,14.68-30.53,16-47.84,17.35-15.23,1.22-30.6.16-45.87-.88-9.66-.66-18.34-10.09-17.88-19.76.59-12.58,0-24.92-5.45-36.58-1-2.16-.73-4.58-.71-6.9,0-4.16.26-8.31-1.14-12.35a8,8,0,0,1,0-5.42c2.59-6.66,1.82-13.8,3.16-20.64.64-3.21-.2-6.29-1.38-9.26-1.64-4.17-2.18-8.34-.33-12.61.53-1.23,1.05-2.75.31-3.87-3.49-5.27-3-11.5-4.35-17.26a14.57,14.57,0,0,0-3.78-7.43c-4.4-4.31-6.31-10.06-8.68-15.53-3.64-8.38-9.74-11.42-18.59-9.57-8.66,1.81-17.5,2.08-26.3,2.56-8.61.47-13.54,5.32-13.51,13.87a44.91,44.91,0,0,1-2.21,15.16c-1.86,5.42-.08,11.27.51,16.8,1.77,16.47,5,32.81,6.23,49.31.7,9.71,2.72,19,4.76,28.36,1.71,7.79,6.76,14.9,13.88,18,10.28,4.41,18.6,26.61,16.77,36.79-.65,3.6-3.49,3.95-6.36,4.46-13.78,2.48-27.77,3.21-41.65,4.78-18.24,2.06-36.56.92-54.81-.48-7.51-.58-12.61-5.66-13-13.14-.47-10.19-1.88-20.31,2.79-30.37,3.53-7.62,2.92-16.43,3.56-24.87,1.26-16.56,3.38-33.05,4.4-49.65.66-10.71-.64-21.47-2.56-31.73-2.22-11.85-6-23.42-12.76-34.38-6-9.79-13.58-18.22-19.71-27.75a5.9,5.9,0,0,1-1.06-2.24c-1.11-9.06-4.26-17.67-6.11-26.47-2-9.7-5-19.32-6.11-29.14A222.54,222.54,0,0,0,36.36,357C34.14,347.88,32.89,338.31,25.42,329.91Z");
  star = new Path2D("M97.8,930.05l31.74-91.46.09-.25-.22-.15L49.94,782.84l96.85,1.9h.27l.07-.25,28.12-92.64,28.12,92.64.08.25h.26l96.86-1.9-79.48,55.35-.22.15.09.25,31.74,91.46-77.24-58.43-.21-.16-.21.16Z");
  result = document.querySelector("#result");

  el.height = 1000;
  el.width = 1000;

  el.onclick = (_) => {
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    audioCtx = new AudioContext();
    const bufferSize = audioCtx.sampleRate * 1000;
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    let data = buffer.getChannelData(0);

    for (let i = 0; i < bufferSize; i++) {
      data[i] = Math.random() * 2 - 1;
    }

    noise = audioCtx.createBufferSource();
    noise.buffer = buffer;
    noise.connect(audioCtx.destination);
    noise.start();
  };
  el.addEventListener("touchmove", handleMove, false);
  el.style.opacity = 0.8;
  ctx = el.getContext('2d');
  ctx.stroke(star);
  ctx.stroke(path);
  ctx.fill(star);
  ctx.fill(path);
}

document.addEventListener("DOMContentLoaded", load);
